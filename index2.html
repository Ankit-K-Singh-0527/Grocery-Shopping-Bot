<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grocery List Collaboration with Budget and Ably</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Custom animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-fadeInUp {
      animation: fadeInUp 0.8s ease-out both;
    }

    @keyframes pulseSlow {
      0%,
      100% {
        opacity: 1;
      }
      50% {
        opacity: 0.8;
      }
    }

    .animate-pulseSlow {
      animation: pulseSlow 2s infinite;
    }
  </style>
</head>

<body class="bg-gradient-to-br from-teal-700 via-cyan-800 to-blue-700 text-gray-100 min-h-screen flex items-center justify-center">
  <div class="container mx-auto p-4">
    <!-- Main App Container -->
    <div class="bg-gradient-to-r from-blue-800 via-blue-600 to-blue-500 shadow-lg rounded-lg p-6 flex flex-col space-y-6">

      <!-- User Info Section -->
      <div>
        <h1 class="text-3xl font-bold mb-4 text-gray-100">Grocery List Collaboration</h1>
        <p class="text-gray-300">Your Unique Code: <span id="userCode" class="font-bold text-yellow-300"></span></p>
      </div>

      <!-- Budget Section -->
      <div>
        <p class="text-gray-100">
          <strong>Budget:</strong> <span id="budgetDisplay" class="text-yellow-300">Not Set</span>
        </p>
        <p class="text-gray-100">
          <strong>Total Price:</strong> <span id="totalPriceDisplay" class="text-yellow-300">$0</span>
        </p>
      </div>

      <!-- Modal for Budget -->
      <div id="budgetModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-gradient-to-r from-green-800 to-green-600 p-6 rounded-lg shadow-lg">
          <h2 class="text-xl font-bold mb-4 text-gray-100">Set Your Budget</h2>
          <input id="budgetModalInput" type="number" placeholder="Enter your budget..." class="border border-green-400 p-2 rounded-md w-full mb-4 bg-green-700 text-gray-100 focus:outline-none focus:border-yellow-300">
          <div class="flex space-x-4">
            <button id="saveBudgetModalButton" class="bg-yellow-500 text-gray-900 px-4 py-2 rounded-md hover:bg-yellow-600 transition">Save</button>
            <button id="closeBudgetButton" class="bg-red-500 text-gray-100 px-4 py-2 rounded-md hover:bg-red-600 transition">Close</button>
          </div>
        </div>
      </div>

      <!-- Set Budget Section -->
      <div class="flex space-x-4">
        <input id="budgetInput" type="number" placeholder="Enter your budget..." class="border border-green-400 p-2 rounded-md w-full bg-green-700 text-gray-100 focus:outline-none focus:border-yellow-300">
        <button id="saveBudgetButton" class="bg-yellow-500 text-gray-900 px-4 py-2 rounded-md hover:bg-yellow-600 transition">Set Budget</button>
      </div>

      <!-- Connect with Others -->
      <div class="flex space-x-4">
        <input id="connectInput" type="text" placeholder="Enter unique code to connect..." class="border border-purple-400 p-2 rounded-md w-full bg-purple-700 text-gray-100 focus:outline-none focus:border-yellow-300">
        <button id="connectButton" class="bg-yellow-500 text-gray-900 px-4 py-2 rounded-md hover:bg-yellow-600 transition">Connect</button>
      </div>
      <p id="connectionStatus" class="text-yellow-200"></p>

      <!-- Grocery List Section -->
      <div class="flex space-x-6">
        <!-- Grocery List -->
        <div class="flex-grow bg-gradient-to-r from-gray-700 to-gray-600 rounded-lg p-4 shadow-md">
          <h2 class="text-xl font-bold mb-4 text-gray-100">Grocery List</h2>
          <div class="flex mb-4">
            <input id="itemInput" type="text" placeholder="Add an item..." class="border border-gray-500 p-2 rounded-md w-full bg-gray-800 text-gray-100 focus:outline-none focus:border-yellow-300">
            <button id="addItemButton" class="bg-yellow-500 text-gray-900 px-4 py-2 rounded-md ml-2 hover:bg-yellow-600 transition">Add</button>
          </div>
          <ul id="groceryList" class="list-disc pl-6 text-gray-300">
            <!-- List items will be dynamically added here -->
          </ul>
        </div>

        <!-- Updated List Section -->
        <div class="w-1/3 bg-gradient-to-r from-teal-700 to-teal-600 rounded-lg p-4 shadow-md">
          <h2 class="text-xl font-bold mb-4 text-gray-100">Updated List</h2>
          <ul id="updatedList" class="list-disc pl-6 text-gray-300">
            <!-- Updated list from other users will be displayed here -->
          </ul>
          <div id="mergeDiscardButtons" class="hidden space-x-4 mt-4">
            <button id="mergeListButton" class="bg-yellow-500 text-gray-900 px-4 py-2 rounded-md hover:bg-yellow-600 transition">Merge</button>
            <button id="discardListButton" class="bg-red-500 text-gray-100 px-4 py-2 rounded-md hover:bg-red-600 transition">Discard</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Fix for "Set Budget" Button
    document.getElementById("saveBudgetButton").addEventListener("click", () => {
      const budgetInput = document.getElementById("budgetInput");
      const budget = parseFloat(budgetInput.value);
      if (!isNaN(budget) && budget > 0) {
        currentBudget = budget;
        document.getElementById("budgetDisplay").textContent = `$${currentBudget}`;
        alert("Budget set successfully!");
        budgetInput.value = ""; // Clear the input box
      } else {
        alert("Please enter a valid budget.");
      }
    });

    // Fix for "Edit" button functionality
    function renderGroceryList() {
      const groceryListEl = document.getElementById("groceryList");
      groceryListEl.innerHTML = "";
      groceryList.forEach((item, index) => {
        const li = document.createElement("li");

        // Display the item details
        const itemSpan = document.createElement("span");
        itemSpan.textContent = `${item.name} - $${item.price} `;
        li.appendChild(itemSpan);

        // Add Edit button
        const editButton = document.createElement("button");
        editButton.textContent = "Edit";
        editButton.style.marginRight = "5px";
        editButton.addEventListener("click", () => {
          const newName = prompt("Enter new name for the item:", item.name);
          const newPriceInput = prompt("Enter new price for the item:", item.price);
          const newPrice = parseFloat(newPriceInput);

          if (newName && !isNaN(newPrice) && newPrice > 0) {
            groceryList[index] = { name: newName, price: newPrice };
            totalPrice = groceryList.reduce((sum, item) => sum + item.price, 0);
            document.getElementById("totalPriceDisplay").textContent = `$${totalPrice}`;
            renderGroceryList();
            publishGroceryList();
          } else {
            alert("Please enter valid details.");
          }
        });
        li.appendChild(editButton);

        // Add Delete button
        const deleteButton = document.createElement("button");
        deleteButton.textContent = "Delete";
        deleteButton.addEventListener("click", () => {
          groceryList.splice(index, 1);
          totalPrice = groceryList.reduce((sum, item) => sum + item.price, 0);
          document.getElementById("totalPriceDisplay").textContent = `$${totalPrice}`;
          renderGroceryList();
          publishGroceryList();
        });
        li.appendChild(deleteButton);

        groceryListEl.appendChild(li);
      });
    }
  </script>
</body>

</html>